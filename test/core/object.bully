require('unit_test')

class ObjectTestClass1
  def foo; 'ObjectTestClass1#foo'; end
  def bar(*args); args; end
end

class ObjectTestClass2 < ObjectTestClass1
end

class ObjectTest < UnitTest
  def test_class_of_Object_is_Class
    assert_equal(Class, Object.class)
  end

  def test_superclass_of_Object_is_nil
    assert_equal(nil, Object.superclass)
  end

  def test_object_instances_should_have_unique_incrementing_object_ids
    id1 = Object.new.object_id

    assert(id1.is_a?(Fixnum))

    10.times do
      id2 = Object.new.object_id
      assert(id2 > id1)
      id1 = id2
    end
  end

  def test_to_s_method_should_return_a_string_containing_class_name_and_object_id
    o1 = Object.new
    o2 = ObjectTestClass1.new

    assert_equal('#<Object:' + o1.object_id + '>', o1.to_s)
    assert_equal('#<ObjectTestClass1:' + o2.object_id + '>', o2.to_s)
  end

  def test_respond_to_method_should_return_false_if_the_given_method_is_nowhere_in_the_super_chain
    assert_equal(false, ObjectTestClass1.new.respond_to?(:notdefined))
  end

  def test_respond_to_method_should_return_true_if_the_given_method_is_defined_directly_on_the_class
    assert_equal(true, ObjectTestClass1.new.respond_to?(:foo))
  end

  def test_respond_to_method_should_return_true_if_the_given_method_is_defined_in_a_super_class
    assert_equal(true, ObjectTestClass1.new.respond_to?(:to_s))
    assert_equal(true, ObjectTestClass2.new.respond_to?(:foo))
  end

  def test_respond_to_method_should_return_true_if_the_given_method_is_defined_in_the_singleton_class
    o = ObjectTestClass1.new

    assert_equal(false, o.respond_to?(:stuff))

    def o.stuff; end

    assert_equal(true, o.respond_to?(:stuff))
  end

  def test_send_method_should_invoke_the_method_with_the_given_name
    assert_equal('ObjectTestClass1#foo', ObjectTestClass1.new.send(:foo))
  end

  def test_send_method_should_pass_given_args_to_the_method
    assert_equal([1,2,3], ObjectTestClass1.new.send(:bar, 1, 2, 3))
  end

  def test_calling_a_method_that_does_not_exist_should_raise_a_NoMethodError
    assert_raise(NoMethodError) { Object.new.doesnotexit }
    assert_raise(NoMethodError) { Object.new.send(:doesnotexist) }
  end
end

